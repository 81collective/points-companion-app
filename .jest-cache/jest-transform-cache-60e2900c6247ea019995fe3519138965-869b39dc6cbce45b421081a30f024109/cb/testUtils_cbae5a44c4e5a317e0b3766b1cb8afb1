50fcf48935234200654d163c1cd921b7
"use strict";
// Testing utilities and setup for Points Companion App
// Provides comprehensive test coverage with 80%+ target
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.setupTests = exports.mockServiceWorker = exports.expectAccessible = exports.expectPerformance = exports.measureRenderTime = exports.mockFetchError = exports.mockFetchResponse = exports.expectErrorState = exports.expectLoadingState = exports.waitForLoadingToFinish = exports.createMockUser = exports.createMockCardRecommendation = exports.createMockBusiness = exports.mockSupabase = exports.mockGoogleMaps = exports.mockGeolocation = exports.customRender = exports.TestWrapper = exports.createTestQueryClient = void 0;
const globals_1 = require("@jest/globals");
const react_1 = __importDefault(require("react"));
const react_2 = require("@testing-library/react");
const react_query_1 = require("@tanstack/react-query");
// Test Query Client
const createTestQueryClient = () => new react_query_1.QueryClient({
    defaultOptions: {
        queries: {
            retry: false,
            gcTime: 0,
        },
        mutations: {
            retry: false,
        },
    },
});
exports.createTestQueryClient = createTestQueryClient;
// Test Wrapper with Query Client
const TestWrapper = ({ children }) => {
    const queryClient = (0, exports.createTestQueryClient)();
    return react_1.default.createElement(react_query_1.QueryClientProvider, { client: queryClient }, children);
};
exports.TestWrapper = TestWrapper;
// Custom render function
const customRender = (ui, options = {}) => (0, react_2.render)(ui, Object.assign({ wrapper: exports.TestWrapper }, options));
exports.customRender = customRender;
// Re-export everything
__exportStar(require("@testing-library/react"), exports);
// Mock implementations
exports.mockGeolocation = {
    getCurrentPosition: globals_1.jest.fn(),
    watchPosition: globals_1.jest.fn(),
    clearWatch: globals_1.jest.fn(),
};
exports.mockGoogleMaps = {
    Maps: globals_1.jest.fn(),
    places: {
        PlacesService: globals_1.jest.fn(),
        PlacesServiceStatus: {
            OK: 'OK',
            ZERO_RESULTS: 'ZERO_RESULTS',
        },
    },
};
exports.mockSupabase = {
    from: globals_1.jest.fn(() => ({
        select: globals_1.jest.fn(() => ({
            eq: globals_1.jest.fn(() => ({
                single: globals_1.jest.fn(() => Promise.resolve({ data: null, error: null })),
            })),
        })),
        insert: globals_1.jest.fn(() => Promise.resolve({ error: null })),
        update: globals_1.jest.fn(() => Promise.resolve({ error: null })),
        delete: globals_1.jest.fn(() => Promise.resolve({ error: null })),
    })),
};
// Test data factories
const createMockBusiness = (overrides = {}) => (Object.assign({ id: 'test-business-1', name: 'Test Restaurant', address: '123 Test St', category: 'restaurant', latitude: 40.7128, longitude: -74.0060, rating: 4.5, price_level: 2, distance: 1000, place_id: 'test_place_id' }, overrides));
exports.createMockBusiness = createMockBusiness;
const createMockCardRecommendation = (overrides = {}) => (Object.assign({ id: 'test-card-1', name: 'Test Rewards Card', issuer: 'Test Bank', category: 'dining', rewardRate: 3.0, annualFee: 95, signupBonus: 'Earn 50,000 points', features: ['3x points on dining', 'No foreign transaction fees'], matchScore: 85 }, overrides));
exports.createMockCardRecommendation = createMockCardRecommendation;
const createMockUser = (overrides = {}) => (Object.assign({ id: 'test-user-1', email: 'test@example.com', name: 'Test User', preferences: {
        favoriteCategories: ['dining', 'travel'],
        notificationSettings: {
            email: true,
            push: true,
            sms: false,
        },
    } }, overrides));
exports.createMockUser = createMockUser;
// Test utilities
const waitForLoadingToFinish = () => (0, react_2.waitFor)(() => {
    expect(react_2.screen.queryByTestId('loading')).not.toBeInTheDocument();
}, { timeout: 5000 });
exports.waitForLoadingToFinish = waitForLoadingToFinish;
const expectLoadingState = () => {
    expect(react_2.screen.getByTestId('loading')).toBeInTheDocument();
};
exports.expectLoadingState = expectLoadingState;
const expectErrorState = (message) => {
    expect(react_2.screen.getByTestId('error')).toBeInTheDocument();
    if (message) {
        expect(react_2.screen.getByText(message)).toBeInTheDocument();
    }
};
exports.expectErrorState = expectErrorState;
const mockFetchResponse = (data, ok = true) => {
    global.fetch = globals_1.jest.fn(() => Promise.resolve({
        ok,
        json: () => Promise.resolve(data),
        text: () => Promise.resolve(JSON.stringify(data)),
    }));
};
exports.mockFetchResponse = mockFetchResponse;
const mockFetchError = (error) => {
    global.fetch = globals_1.jest.fn(() => Promise.reject(error));
};
exports.mockFetchError = mockFetchError;
// Performance testing utilities
const measureRenderTime = async (component) => {
    const startTime = performance.now();
    (0, exports.customRender)(component);
    await (0, react_2.waitFor)(() => {
        expect(document.body).toBeInTheDocument();
    });
    const endTime = performance.now();
    return endTime - startTime;
};
exports.measureRenderTime = measureRenderTime;
const expectPerformance = (renderTime, threshold = 100) => {
    expect(renderTime).toBeLessThan(threshold);
};
exports.expectPerformance = expectPerformance;
// Accessibility testing utilities
const expectAccessible = (container) => {
    // Check for ARIA labels
    const buttons = container.querySelectorAll('button');
    buttons.forEach(button => {
        expect(button).toHaveAttribute('aria-label');
    });
    // Check for alt text on images
    const images = container.querySelectorAll('img');
    images.forEach(img => {
        expect(img).toHaveAttribute('alt');
    });
    // Check for proper heading hierarchy
    const headings = container.querySelectorAll('h1, h2, h3, h4, h5, h6');
    let lastLevel = 0;
    headings.forEach(heading => {
        const level = parseInt(heading.tagName.charAt(1));
        expect(level).toBeGreaterThanOrEqual(lastLevel);
        lastLevel = level;
    });
};
exports.expectAccessible = expectAccessible;
// Mock service worker
exports.mockServiceWorker = {
    register: globals_1.jest.fn(() => Promise.resolve({
        active: { state: 'activated' },
        waiting: null,
        installing: null,
    })),
    addEventListener: globals_1.jest.fn(),
    removeEventListener: globals_1.jest.fn(),
};
// Setup function for all tests
const setupTests = () => {
    // Mock window methods
    Object.defineProperty(window, 'matchMedia', {
        writable: true,
        value: globals_1.jest.fn().mockImplementation(query => ({
            matches: false,
            media: query,
            onchange: null,
            addListener: globals_1.jest.fn(),
            removeListener: globals_1.jest.fn(),
            addEventListener: globals_1.jest.fn(),
            removeEventListener: globals_1.jest.fn(),
            dispatchEvent: globals_1.jest.fn(),
        })),
    });
    // Mock IntersectionObserver
    const mockIntersectionObserver = globals_1.jest.fn().mockImplementation(() => ({
        observe: globals_1.jest.fn(),
        unobserve: globals_1.jest.fn(),
        disconnect: globals_1.jest.fn(),
    }));
    global.IntersectionObserver = mockIntersectionObserver;
    // Mock ResizeObserver
    const mockResizeObserver = globals_1.jest.fn().mockImplementation(() => ({
        observe: globals_1.jest.fn(),
        unobserve: globals_1.jest.fn(),
        disconnect: globals_1.jest.fn(),
    }));
    global.ResizeObserver = mockResizeObserver;
    // Mock geolocation
    Object.defineProperty(navigator, 'geolocation', {
        value: exports.mockGeolocation,
        writable: true,
    });
    // Mock service worker
    Object.defineProperty(navigator, 'serviceWorker', {
        value: exports.mockServiceWorker,
        writable: true,
    });
    // Mock Google Maps
    global.google = exports.mockGoogleMaps;
    // Mock localStorage
    const localStorageMock = {
        getItem: globals_1.jest.fn(),
        setItem: globals_1.jest.fn(),
        removeItem: globals_1.jest.fn(),
        clear: globals_1.jest.fn(),
    };
    Object.defineProperty(window, 'localStorage', {
        value: localStorageMock,
    });
    // Mock sessionStorage
    const sessionStorageMock = {
        getItem: globals_1.jest.fn(),
        setItem: globals_1.jest.fn(),
        removeItem: globals_1.jest.fn(),
        clear: globals_1.jest.fn(),
    };
    Object.defineProperty(window, 'sessionStorage', {
        value: sessionStorageMock,
    });
};
exports.setupTests = setupTests;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxNZWRpYSBTZXJ2ZXJcXERvY3VtZW50c1xcUHJvamVjdHNcXHBvaW50cy1jb21wYW5pb24tYXBwXFxzcmNcXHRlc3RcXHRlc3RVdGlscy50cyIsIm1hcHBpbmdzIjoiO0FBQUEsdURBQXVEO0FBQ3ZELHdEQUF3RDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFLeEQsMkNBQXFDO0FBSHJDLGtEQUF1RDtBQUN2RCxrREFBaUU7QUFDakUsdURBQXlFO0FBR3pFLG9CQUFvQjtBQUNiLE1BQU0scUJBQXFCLEdBQUcsR0FBRyxFQUFFLENBQUMsSUFBSSx5QkFBVyxDQUFDO0lBQ3pELGNBQWMsRUFBRTtRQUNkLE9BQU8sRUFBRTtZQUNQLEtBQUssRUFBRSxLQUFLO1lBQ1osTUFBTSxFQUFFLENBQUM7U0FDVjtRQUNELFNBQVMsRUFBRTtZQUNULEtBQUssRUFBRSxLQUFLO1NBQ2I7S0FDRjtDQUNGLENBQUMsQ0FBQztBQVZVLFFBQUEscUJBQXFCLHlCQVUvQjtBQUVILGlDQUFpQztBQUMxQixNQUFNLFdBQVcsR0FBRyxDQUFDLEVBQUUsUUFBUSxFQUEyQixFQUFFLEVBQUU7SUFDbkUsTUFBTSxXQUFXLEdBQUcsSUFBQSw2QkFBcUIsR0FBRSxDQUFDO0lBRTVDLE9BQU8sZUFBSyxDQUFDLGFBQWEsQ0FBQyxpQ0FBbUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsRUFBRSxRQUFRLENBQUMsQ0FBQztBQUNyRixDQUFDLENBQUM7QUFKVyxRQUFBLFdBQVcsZUFJdEI7QUFFRix5QkFBeUI7QUFDbEIsTUFBTSxZQUFZLEdBQUcsQ0FBQyxFQUFnQixFQUFFLE9BQU8sR0FBRyxFQUFFLEVBQUUsRUFBRSxDQUM3RCxJQUFBLGNBQU0sRUFBQyxFQUFFLGtCQUFJLE9BQU8sRUFBRSxtQkFBVyxJQUFLLE9BQU8sRUFBRyxDQUFDO0FBRHRDLFFBQUEsWUFBWSxnQkFDMEI7QUFFbkQsdUJBQXVCO0FBQ3ZCLHlEQUF1QztBQUV2Qyx1QkFBdUI7QUFDVixRQUFBLGVBQWUsR0FBRztJQUM3Qixr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LENBQUM7SUFFSCxzQkFBc0I7SUFDdEIsTUFBTSxrQkFBa0IsR0FBRztRQUN6QixPQUFPLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtRQUNsQixPQUFPLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtRQUNsQixVQUFVLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtRQUNyQixLQUFLLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtLQUNqQixDQUFDO0lBQ0YsTUFBTSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsZ0JBQWdCLEVBQUU7UUFDOUMsS0FBSyxFQUFFLGtCQUFrQjtLQUMxQixDQUFDLENBQUM7QUFDTCxDQUFDLENBQUM7QUFwRVcsUUFBQSxVQUFVLGNBb0VyQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXE1lZGlhIFNlcnZlclxcRG9jdW1lbnRzXFxQcm9qZWN0c1xccG9pbnRzLWNvbXBhbmlvbi1hcHBcXHNyY1xcdGVzdFxcdGVzdFV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFRlc3RpbmcgdXRpbGl0aWVzIGFuZCBzZXR1cCBmb3IgUG9pbnRzIENvbXBhbmlvbiBBcHBcclxuLy8gUHJvdmlkZXMgY29tcHJlaGVuc2l2ZSB0ZXN0IGNvdmVyYWdlIHdpdGggODAlKyB0YXJnZXRcclxuXHJcbmltcG9ydCBSZWFjdCwgeyBSZWFjdEVsZW1lbnQsIFJlYWN0Tm9kZSB9IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IHsgcmVuZGVyLCBzY3JlZW4sIHdhaXRGb3IgfSBmcm9tICdAdGVzdGluZy1saWJyYXJ5L3JlYWN0JztcclxuaW1wb3J0IHsgUXVlcnlDbGllbnQsIFF1ZXJ5Q2xpZW50UHJvdmlkZXIgfSBmcm9tICdAdGFuc3RhY2svcmVhY3QtcXVlcnknO1xyXG5pbXBvcnQgeyBqZXN0IH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XHJcblxyXG4vLyBUZXN0IFF1ZXJ5IENsaWVudFxyXG5leHBvcnQgY29uc3QgY3JlYXRlVGVzdFF1ZXJ5Q2xpZW50ID0gKCkgPT4gbmV3IFF1ZXJ5Q2xpZW50KHtcclxuICBkZWZhdWx0T3B0aW9uczoge1xyXG4gICAgcXVlcmllczoge1xyXG4gICAgICByZXRyeTogZmFsc2UsXHJcbiAgICAgIGdjVGltZTogMCxcclxuICAgIH0sXHJcbiAgICBtdXRhdGlvbnM6IHtcclxuICAgICAgcmV0cnk6IGZhbHNlLFxyXG4gICAgfSxcclxuICB9LFxyXG59KTtcclxuXHJcbi8vIFRlc3QgV3JhcHBlciB3aXRoIFF1ZXJ5IENsaWVudFxyXG5leHBvcnQgY29uc3QgVGVzdFdyYXBwZXIgPSAoeyBjaGlsZHJlbiB9OiB7IGNoaWxkcmVuOiBSZWFjdE5vZGUgfSkgPT4ge1xyXG4gIGNvbnN0IHF1ZXJ5Q2xpZW50ID0gY3JlYXRlVGVzdFF1ZXJ5Q2xpZW50KCk7XHJcblxyXG4gIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KFF1ZXJ5Q2xpZW50UHJvdmlkZXIsIHsgY2xpZW50OiBxdWVyeUNsaWVudCB9LCBjaGlsZHJlbik7XHJcbn07XHJcblxyXG4vLyBDdXN0b20gcmVuZGVyIGZ1bmN0aW9uXHJcbmV4cG9ydCBjb25zdCBjdXN0b21SZW5kZXIgPSAodWk6IFJlYWN0RWxlbWVudCwgb3B0aW9ucyA9IHt9KSA9PlxyXG4gIHJlbmRlcih1aSwgeyB3cmFwcGVyOiBUZXN0V3JhcHBlciwgLi4ub3B0aW9ucyB9KTtcclxuXHJcbi8vIFJlLWV4cG9ydCBldmVyeXRoaW5nXHJcbmV4cG9ydCAqIGZyb20gJ0B0ZXN0aW5nLWxpYnJhcnkvcmVhY3QnO1xyXG5cclxuLy8gTW9jayBpbXBsZW1lbnRhdGlvbnNcclxuZXhwb3J0IGNvbnN0IG1vY2tHZW9sb2NhdGlvbiA9IHtcclxuICBnZXRDdXJyZW50UG9zaXRpb246IGplc3QuZm4oKSxcclxuICB3YXRjaFBvc2l0aW9uOiBqZXN0LmZuKCksXHJcbiAgY2xlYXJXYXRjaDogamVzdC5mbigpLFxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IG1vY2tHb29nbGVNYXBzID0ge1xyXG4gIE1hcHM6IGplc3QuZm4oKSxcclxuICBwbGFjZXM6IHtcclxuICAgIFBsYWNlc1NlcnZpY2U6IGplc3QuZm4oKSxcclxuICAgIFBsYWNlc1NlcnZpY2VTdGF0dXM6IHtcclxuICAgICAgT0s6ICdPSycsXHJcbiAgICAgIFpFUk9fUkVTVUxUUzogJ1pFUk9fUkVTVUxUUycsXHJcbiAgICB9LFxyXG4gIH0sXHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgbW9ja1N1cGFiYXNlID0ge1xyXG4gIGZyb206IGplc3QuZm4oKCkgPT4gKHtcclxuICAgIHNlbGVjdDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgIHNpbmdsZTogamVzdC5mbigoKSA9PiBQcm9taXNlLnJlc29sdmUoeyBkYXRhOiBudWxsLCBlcnJvcjogbnVsbCB9KSksXHJcbiAgICAgIH0pKSxcclxuICAgIH0pKSxcclxuICAgIGluc2VydDogamVzdC5mbigoKSA9PiBQcm9taXNlLnJlc29sdmUoeyBlcnJvcjogbnVsbCB9KSksXHJcbiAgICB1cGRhdGU6IGplc3QuZm4oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHsgZXJyb3I6IG51bGwgfSkpLFxyXG4gICAgZGVsZXRlOiBqZXN0LmZuKCgpID0+IFByb21pc2UucmVzb2x2ZSh7IGVycm9yOiBudWxsIH0pKSxcclxuICB9KSksXHJcbn07XHJcblxyXG4vLyBUZXN0IGRhdGEgZmFjdG9yaWVzXHJcbmV4cG9ydCBjb25zdCBjcmVhdGVNb2NrQnVzaW5lc3MgPSAob3ZlcnJpZGVzID0ge30pID0+ICh7XHJcbiAgaWQ6ICd0ZXN0LWJ1c2luZXNzLTEnLFxyXG4gIG5hbWU6ICdUZXN0IFJlc3RhdXJhbnQnLFxyXG4gIGFkZHJlc3M6ICcxMjMgVGVzdCBTdCcsXHJcbiAgY2F0ZWdvcnk6ICdyZXN0YXVyYW50JyxcclxuICBsYXRpdHVkZTogNDAuNzEyOCxcclxuICBsb25naXR1ZGU6IC03NC4wMDYwLFxyXG4gIHJhdGluZzogNC41LFxyXG4gIHByaWNlX2xldmVsOiAyLFxyXG4gIGRpc3RhbmNlOiAxMDAwLFxyXG4gIHBsYWNlX2lkOiAndGVzdF9wbGFjZV9pZCcsXHJcbiAgLi4ub3ZlcnJpZGVzLFxyXG59KTtcclxuXHJcbmV4cG9ydCBjb25zdCBjcmVhdGVNb2NrQ2FyZFJlY29tbWVuZGF0aW9uID0gKG92ZXJyaWRlcyA9IHt9KSA9PiAoe1xyXG4gIGlkOiAndGVzdC1jYXJkLTEnLFxyXG4gIG5hbWU6ICdUZXN0IFJld2FyZHMgQ2FyZCcsXHJcbiAgaXNzdWVyOiAnVGVzdCBCYW5rJyxcclxuICBjYXRlZ29yeTogJ2RpbmluZycsXHJcbiAgcmV3YXJkUmF0ZTogMy4wLFxyXG4gIGFubnVhbEZlZTogOTUsXHJcbiAgc2lnbnVwQm9udXM6ICdFYXJuIDUwLDAwMCBwb2ludHMnLFxyXG4gIGZlYXR1cmVzOiBbJzN4IHBvaW50cyBvbiBkaW5pbmcnLCAnTm8gZm9yZWlnbiB0cmFuc2FjdGlvbiBmZWVzJ10sXHJcbiAgbWF0Y2hTY29yZTogODUsXHJcbiAgLi4ub3ZlcnJpZGVzLFxyXG59KTtcclxuXHJcbmV4cG9ydCBjb25zdCBjcmVhdGVNb2NrVXNlciA9IChvdmVycmlkZXMgPSB7fSkgPT4gKHtcclxuICBpZDogJ3Rlc3QtdXNlci0xJyxcclxuICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxyXG4gIG5hbWU6ICdUZXN0IFVzZXInLFxyXG4gIHByZWZlcmVuY2VzOiB7XHJcbiAgICBmYXZvcml0ZUNhdGVnb3JpZXM6IFsnZGluaW5nJywgJ3RyYXZlbCddLFxyXG4gICAgbm90aWZpY2F0aW9uU2V0dGluZ3M6IHtcclxuICAgICAgZW1haWw6IHRydWUsXHJcbiAgICAgIHB1c2g6IHRydWUsXHJcbiAgICAgIHNtczogZmFsc2UsXHJcbiAgICB9LFxyXG4gIH0sXHJcbiAgLi4ub3ZlcnJpZGVzLFxyXG59KTtcclxuXHJcbi8vIFRlc3QgdXRpbGl0aWVzXHJcbmV4cG9ydCBjb25zdCB3YWl0Rm9yTG9hZGluZ1RvRmluaXNoID0gKCkgPT5cclxuICB3YWl0Rm9yKCgpID0+IHtcclxuICAgIGV4cGVjdChzY3JlZW4ucXVlcnlCeVRlc3RJZCgnbG9hZGluZycpKS5ub3QudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICB9LCB7IHRpbWVvdXQ6IDUwMDAgfSk7XHJcblxyXG5leHBvcnQgY29uc3QgZXhwZWN0TG9hZGluZ1N0YXRlID0gKCkgPT4ge1xyXG4gIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2xvYWRpbmcnKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBleHBlY3RFcnJvclN0YXRlID0gKG1lc3NhZ2U/OiBzdHJpbmcpID0+IHtcclxuICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdlcnJvcicpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xyXG4gIGlmIChtZXNzYWdlKSB7XHJcbiAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dChtZXNzYWdlKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgbW9ja0ZldGNoUmVzcG9uc2UgPSAoZGF0YTogYW55LCBvayA9IHRydWUpID0+IHtcclxuICBnbG9iYWwuZmV0Y2ggPSBqZXN0LmZuKCgpID0+XHJcbiAgICBQcm9taXNlLnJlc29sdmUoe1xyXG4gICAgICBvayxcclxuICAgICAganNvbjogKCkgPT4gUHJvbWlzZS5yZXNvbHZlKGRhdGEpLFxyXG4gICAgICB0ZXh0OiAoKSA9PiBQcm9taXNlLnJlc29sdmUoSlNPTi5zdHJpbmdpZnkoZGF0YSkpLFxyXG4gICAgfSBhcyBSZXNwb25zZSlcclxuICApO1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IG1vY2tGZXRjaEVycm9yID0gKGVycm9yOiBFcnJvcikgPT4ge1xyXG4gIGdsb2JhbC5mZXRjaCA9IGplc3QuZm4oKCkgPT4gUHJvbWlzZS5yZWplY3QoZXJyb3IpKTtcclxufTtcclxuXHJcbi8vIFBlcmZvcm1hbmNlIHRlc3RpbmcgdXRpbGl0aWVzXHJcbmV4cG9ydCBjb25zdCBtZWFzdXJlUmVuZGVyVGltZSA9IGFzeW5jIChjb21wb25lbnQ6IFJlYWN0RWxlbWVudCkgPT4ge1xyXG4gIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG5cclxuICBjdXN0b21SZW5kZXIoY29tcG9uZW50KTtcclxuXHJcbiAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICBleHBlY3QoZG9jdW1lbnQuYm9keSkudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICB9KTtcclxuXHJcbiAgY29uc3QgZW5kVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG4gIHJldHVybiBlbmRUaW1lIC0gc3RhcnRUaW1lO1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGV4cGVjdFBlcmZvcm1hbmNlID0gKHJlbmRlclRpbWU6IG51bWJlciwgdGhyZXNob2xkID0gMTAwKSA9PiB7XHJcbiAgZXhwZWN0KHJlbmRlclRpbWUpLnRvQmVMZXNzVGhhbih0aHJlc2hvbGQpO1xyXG59O1xyXG5cclxuLy8gQWNjZXNzaWJpbGl0eSB0ZXN0aW5nIHV0aWxpdGllc1xyXG5leHBvcnQgY29uc3QgZXhwZWN0QWNjZXNzaWJsZSA9IChjb250YWluZXI6IEhUTUxFbGVtZW50KSA9PiB7XHJcbiAgLy8gQ2hlY2sgZm9yIEFSSUEgbGFiZWxzXHJcbiAgY29uc3QgYnV0dG9ucyA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCdidXR0b24nKTtcclxuICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IHtcclxuICAgIGV4cGVjdChidXR0b24pLnRvSGF2ZUF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcpO1xyXG4gIH0pO1xyXG5cclxuICAvLyBDaGVjayBmb3IgYWx0IHRleHQgb24gaW1hZ2VzXHJcbiAgY29uc3QgaW1hZ2VzID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ2ltZycpO1xyXG4gIGltYWdlcy5mb3JFYWNoKGltZyA9PiB7XHJcbiAgICBleHBlY3QoaW1nKS50b0hhdmVBdHRyaWJ1dGUoJ2FsdCcpO1xyXG4gIH0pO1xyXG5cclxuICAvLyBDaGVjayBmb3IgcHJvcGVyIGhlYWRpbmcgaGllcmFyY2h5XHJcbiAgY29uc3QgaGVhZGluZ3MgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnaDEsIGgyLCBoMywgaDQsIGg1LCBoNicpO1xyXG4gIGxldCBsYXN0TGV2ZWwgPSAwO1xyXG4gIGhlYWRpbmdzLmZvckVhY2goaGVhZGluZyA9PiB7XHJcbiAgICBjb25zdCBsZXZlbCA9IHBhcnNlSW50KGhlYWRpbmcudGFnTmFtZS5jaGFyQXQoMSkpO1xyXG4gICAgZXhwZWN0KGxldmVsKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKGxhc3RMZXZlbCk7XHJcbiAgICBsYXN0TGV2ZWwgPSBsZXZlbDtcclxuICB9KTtcclxufTtcclxuXHJcbi8vIE1vY2sgc2VydmljZSB3b3JrZXJcclxuZXhwb3J0IGNvbnN0IG1vY2tTZXJ2aWNlV29ya2VyID0ge1xyXG4gIHJlZ2lzdGVyOiBqZXN0LmZuKCgpID0+IFByb21pc2UucmVzb2x2ZSh7XHJcbiAgICBhY3RpdmU6IHsgc3RhdGU6ICdhY3RpdmF0ZWQnIH0sXHJcbiAgICB3YWl0aW5nOiBudWxsLFxyXG4gICAgaW5zdGFsbGluZzogbnVsbCxcclxuICB9KSksXHJcbiAgYWRkRXZlbnRMaXN0ZW5lcjogamVzdC5mbigpLFxyXG4gIHJlbW92ZUV2ZW50TGlzdGVuZXI6IGplc3QuZm4oKSxcclxufTtcclxuXHJcbi8vIFNldHVwIGZ1bmN0aW9uIGZvciBhbGwgdGVzdHNcclxuZXhwb3J0IGNvbnN0IHNldHVwVGVzdHMgPSAoKSA9PiB7XHJcbiAgLy8gTW9jayB3aW5kb3cgbWV0aG9kc1xyXG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3csICdtYXRjaE1lZGlhJywge1xyXG4gICAgd3JpdGFibGU6IHRydWUsXHJcbiAgICB2YWx1ZTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbihxdWVyeSA9PiAoe1xyXG4gICAgICBtYXRjaGVzOiBmYWxzZSxcclxuICAgICAgbWVkaWE6IHF1ZXJ5LFxyXG4gICAgICBvbmNoYW5nZTogbnVsbCxcclxuICAgICAgYWRkTGlzdGVuZXI6IGplc3QuZm4oKSxcclxuICAgICAgcmVtb3ZlTGlzdGVuZXI6IGplc3QuZm4oKSxcclxuICAgICAgYWRkRXZlbnRMaXN0ZW5lcjogamVzdC5mbigpLFxyXG4gICAgICByZW1vdmVFdmVudExpc3RlbmVyOiBqZXN0LmZuKCksXHJcbiAgICAgIGRpc3BhdGNoRXZlbnQ6IGplc3QuZm4oKSxcclxuICAgIH0pKSxcclxuICB9KTtcclxuXHJcbiAgLy8gTW9jayBJbnRlcnNlY3Rpb25PYnNlcnZlclxyXG4gIGNvbnN0IG1vY2tJbnRlcnNlY3Rpb25PYnNlcnZlciA9IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcclxuICAgIG9ic2VydmU6IGplc3QuZm4oKSxcclxuICAgIHVub2JzZXJ2ZTogamVzdC5mbigpLFxyXG4gICAgZGlzY29ubmVjdDogamVzdC5mbigpLFxyXG4gIH0pKTtcclxuICAoZ2xvYmFsIGFzIGFueSkuSW50ZXJzZWN0aW9uT2JzZXJ2ZXIgPSBtb2NrSW50ZXJzZWN0aW9uT2JzZXJ2ZXI7XHJcblxyXG4gIC8vIE1vY2sgUmVzaXplT2JzZXJ2ZXJcclxuICBjb25zdCBtb2NrUmVzaXplT2JzZXJ2ZXIgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XHJcbiAgICBvYnNlcnZlOiBqZXN0LmZuKCksXHJcbiAgICB1bm9ic2VydmU6IGplc3QuZm4oKSxcclxuICAgIGRpc2Nvbm5lY3Q6IGplc3QuZm4oKSxcclxuICB9KSk7XHJcbiAgKGdsb2JhbCBhcyBhbnkpLlJlc2l6ZU9ic2VydmVyID0gbW9ja1Jlc2l6ZU9ic2VydmVyO1xyXG5cclxuICAvLyBNb2NrIGdlb2xvY2F0aW9uXHJcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5hdmlnYXRvciwgJ2dlb2xvY2F0aW9uJywge1xyXG4gICAgdmFsdWU6IG1vY2tHZW9sb2NhdGlvbixcclxuICAgIHdyaXRhYmxlOiB0cnVlLFxyXG4gIH0pO1xyXG5cclxuICAvLyBNb2NrIHNlcnZpY2Ugd29ya2VyXHJcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5hdmlnYXRvciwgJ3NlcnZpY2VXb3JrZXInLCB7XHJcbiAgICB2YWx1ZTogbW9ja1NlcnZpY2VXb3JrZXIsXHJcbiAgICB3cml0YWJsZTogdHJ1ZSxcclxuICB9KTtcclxuXHJcbiAgLy8gTW9jayBHb29nbGUgTWFwc1xyXG4gIChnbG9iYWwgYXMgYW55KS5nb29nbGUgPSBtb2NrR29vZ2xlTWFwcztcclxuXHJcbiAgLy8gTW9jayBsb2NhbFN0b3JhZ2VcclxuICBjb25zdCBsb2NhbFN0b3JhZ2VNb2NrID0ge1xyXG4gICAgZ2V0SXRlbTogamVzdC5mbigpLFxyXG4gICAgc2V0SXRlbTogamVzdC5mbigpLFxyXG4gICAgcmVtb3ZlSXRlbTogamVzdC5mbigpLFxyXG4gICAgY2xlYXI6IGplc3QuZm4oKSxcclxuICB9O1xyXG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3csICdsb2NhbFN0b3JhZ2UnLCB7XHJcbiAgICB2YWx1ZTogbG9jYWxTdG9yYWdlTW9jayxcclxuICB9KTtcclxuXHJcbiAgLy8gTW9jayBzZXNzaW9uU3RvcmFnZVxyXG4gIGNvbnN0IHNlc3Npb25TdG9yYWdlTW9jayA9IHtcclxuICAgIGdldEl0ZW06IGplc3QuZm4oKSxcclxuICAgIHNldEl0ZW06IGplc3QuZm4oKSxcclxuICAgIHJlbW92ZUl0ZW06IGplc3QuZm4oKSxcclxuICAgIGNsZWFyOiBqZXN0LmZuKCksXHJcbiAgfTtcclxuICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnc2Vzc2lvblN0b3JhZ2UnLCB7XHJcbiAgICB2YWx1ZTogc2Vzc2lvblN0b3JhZ2VNb2NrLFxyXG4gIH0pO1xyXG59O1xyXG4iXSwidmVyc2lvbiI6M30=